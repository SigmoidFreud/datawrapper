var Datawrapper={};(function(){var root=this,dw={};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=dw}exports.dw=dw}else{root.dw=dw}dw.dataset=function(columns,opts){var columnsByName={};_.each(columns,function(col){var origColName=col.name(),colName=origColName,appendix=1;while(columnsByName.hasOwnProperty(colName)){colName=origColName+"."+appendix++}if(colName!=origColName)col.name(colName);columnsByName[colName]=col});opts=_.extend(opts,{firstColumnAsLabel:true});var dataset={columns:function(){return columns},column:function(x){if(_.isString(x)){if(columnsByName[x]!==undefined)return columnsByName[x];throw'No column found with that name: "'+x+'"'}if(columns[x]!==undefined)return columns[x];throw"No series found with that index: "+x},numColumns:function(){return columns.length},numRows:function(){return columns[0].length},series:function(x){if(x!==undefined){return dataset.column(x)}return dataset.columns()},hasRowNames:function(){return opts.firstRowAsLabel},eachSeries:function(func){_.each(columns,func)},eachRow:function(func){var i;for(i=0;i<dataset.numRows();i++){func(i)}},rowNames:function(){return columns[0].raw()},rowName:function(i){if(!me.hasRowNames())return"";var k=dataset.numRows;return columns[0].raw()[(i+k)%k]},rowNameLabel:function(){return columns[0].name()},filterRows:function(rows){_.each(columns,function(col){if(rows)col.filterRows(rows);else col.filterRows()})},filterSeries:function(ignore){var me=this;me.__data.series=me.__data.series.filter(function(s){return!ignore[s.name]})},isTimeSeries:function(){return this.__rowDates!==undefined},rowDate:function(i){if(i<0)i+=this.__rowDates.length;return this.__rowDates[i]},rowDates:function(){return this.__rowDates.slice(0)},minMax:function(){var minmax=[Number.MAX_VALUE,-Number.MAX_VALUE];this.eachSeries(function(s){minmax[0]=Math.min(minmax[0],s.min);minmax[1]=Math.max(minmax[1],s.max)});return minmax}};return dataset};dw.column=function(name,rows,type){function guessType(){if(_.every(rows,_.isNumber))return dw.column.types.number();if(_.every(rows,_.isDate))return dw.column.types.date();var types=[dw.column.types.date(rows.slice(0,20)),dw.column.types.number(rows.slice(0,20)),dw.column.types.text()],type,k=rows.length,tolerance=.1;_.each(rows,function(val){_.each(types,function(t){t.parse(val)})});_.every(types,function(t){if(t.errors()/k<tolerance)type=t;return!type});return type}type=type?dw.column.types[type](rows.slice(0,50)):guessType();var range,total,origRows=rows.slice(0);var column={name:function(){if(arguments.length){name=arguments[0];return column}return name},length:rows.length,val:function(i){return type.parse(rows[i])},each:function(f){for(i=0;i<rows.length;i++){f(column.val(i),i)}},raw:function(){return rows},type:function(){return type.name()},range:function(){if(!type.toNum)return false;if(!range){range=[Number.MAX_VALUE,-Number.MAX_VALUE];column.each(function(v){v=type.toNum(v);if(v<range[0])range[0]=v;if(v>range[1])range[1]=v});range[0]=type.fromNum(range[0]);range[1]=type.fromNum(range[1])}return range},total:function(){if(!type.toNum)return false;if(!total){total=0;column.each(function(v){total+=type.toNum(v)});total=type.fromNum(total)}return total},filterRows:function(r){rows=[];if(arguments.length){_.each(r,function(i){rows.push(origRows[i])})}else{rows=origRows.slice(0)}column.length=rows.length;range=total=false;return column},toString:function(){return name+" ("+type.name()+")"}};return column};dw.column.types={};dw.column.types.text=function(){return{parse:function(v){return v},errors:function(){return 0},name:function(){return"text"}}};dw.column.types.number=function(sample){var format,errors=0,knownFormats={"-.":/^ *-?[0-9]*(\.[0-9]+)? *$/,"-,":/^ *-?[0-9]*(,[0-9]+)? *$/,",.":/^ *-?[0-9]{1,3}(,[0-9]{3})*(\.[0-9]+)? *$/,".,":/^ *-?[0-9]{1,3}(\.[0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/," .":/^ *-?[0-9]{1,3}( [0-9]{3})*(\.[0-9]+)? *$/," ,":/^ *-?[0-9]{1,3}( [0-9]{3})*(,[0-9]+)? *$/};var matches={},bestMatch=["-.",0];sample=sample||[];_.each(sample,function(n){_.each(knownFormats,function(regex,fmt){if(matches[fmt]===undefined)matches[fmt]=0;if(regex.test(n)){matches[fmt]+=1;if(matches[fmt]>bestMatch[1]){bestMatch[0]=fmt;bestMatch[1]=matches[fmt]}}})});format=bestMatch[0];var type={parse:function(raw){if(_.isNumber(raw))return raw;var number=raw;if(format[0]!="-"){number=number.replace(format[0],"")}if(format[1]!="."){number=number.replace(format[1],".")}number=Number(number);if(isNaN(number)){errors++;return raw}return number},toNum:function(i){return i},fromNum:function(i){return i},errors:function(){return errors},name:function(){return"number"}};return type};dw.column.types.date=function(sample){var format,errors=0,matches={},bestMatch=["",0],knownFormats={YYYY:/^ *([12][0-9]{3}) *$/,"YYYY-H":/^ *([12][0-9]{3})[ \-\/]?H([12]) *$/,"H-YYYY":/^ *H([12])[ \-\/]([12][0-9]{3}) *$/,"YYYY-Q":/^ *([12][0-9]{3})[ \-\/]?Q([1234]) *$/,"Q-YYYY":/^ *Q([1234])[ \-\/]([12][0-9]{3}) *$/,"YYYY-M":/^ *([12][0-9]{3}) ?[ -\/\.](0?[1-9]|1[0-2]) *$/,"M-YYYY":/^ *(0?[1-9]|1[0-2]) ?[ -\/\.]([12][0-9]{3}) *$/,"MM/DD/YYYY":/^ *(0?[1-9]|1[0-2])([-\/] ?)(0?[1-9]|[1-2][0-9]|3[01])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,"DD.MM.YYYY":/^ *(0?[1-9]|[1-2][0-9]|3[01])([-\.\/ ?])(0?[1-9]|1[0-2])\2([12][0-9]{3})(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/,"YYYY-MM-DD":/^ *([12][0-9]{3})([-\/\. ?])(0?[1-9]|1[0-2])\2(0?[1-9]|[1-2][0-9]|3[01])(?: (0?[0-9]|1[0-9]|2[0-3]):([0-5][0-9])(?::([0-5][0-9]))?)? *$/};sample=sample||[];_.each(sample,function(n){_.each(knownFormats,function(regex,fmt){if(matches[fmt]===undefined)matches[fmt]=0;if(regex.test(n)){matches[fmt]+=1;if(matches[fmt]>bestMatch[1]){bestMatch[0]=fmt;bestMatch[1]=matches[fmt]}}})});format=bestMatch[0];var type={parse:function(raw){if(_.isDate(raw))return raw;if(format===false||!_.isString(raw)){errors++;return raw}var regex=knownFormats[format],m=raw.match(regex);if(!m){errors++;console.log("err",raw,regex);return raw}switch(format){case"YYYY":return new Date(m[1],0,1);case"YYYY-H":return new Date(m[1],(m[2]-1)*6,1);case"H-YYYY":return new Date(m[2],(m[1]-1)*6,1);case"YYYY-Q":return new Date(m[1],(m[2]-1)*3,1);case"Q-YYYY":return new Date(m[2],(m[1]-1)*3,1);case"YYYY-M":return new Date(m[1],m[2]-1,1);case"M-YYYY":return new Date(m[2],m[1]-1,1);case"YYYY-MM-DD":return new Date(m[1],m[3]-1,m[4],m[5]||0,m[6]||0,m[7]||0);case"DD.MM.YYYY":return new Date(m[4],m[3]-1,m[1],m[5]||0,m[6]||0,m[7]||0);case"MM/DD/YYYY":return new Date(m[4],m[1]-1,m[3],m[5]||0,m[6]||0,m[7]||0)}errors++;return raw},toNum:function(d){return d.getTime()},fromNum:function(i){return new Date(i)},errors:function(){return errors},name:function(){return"date"}};return type};dw.datasource={};dw.datasource.delimited=function(opts){function loadAndParseCsv(){if(opts.url){return $.ajax({url:opts.url,method:"GET",dataType:"text"}).then(function(raw){return new DelimitedParser(opts).parse(raw)})}else if(opts.csv){var dfd=$.Deferred(),parsed=dfd.then(function(raw){return new DelimitedParser(opts).parse(raw)});dfd.resolve(opts.csv);return parsed}throw"you need to provide either an URL or CSV data."}var delimited={dataset:function(){return loadAndParseCsv()}};return delimited};var DelimitedParser=function(opts){opts=_.extend(opts,{delimiter:"auto",quoteChar:'"',skipRows:0,emptyValue:null,transpose:false,firstRowIsHeader:true,firstColumnIsHeader:true});this.__delimiterPatterns=getDelimiterPatterns(opts.delimiter,opts.quoteChar);this.opts=opts};function getDelimiterPatterns(delimiter,quoteChar){return new RegExp("(\\"+delimiter+"|\\r?\\n|\\r|^)"+"(?:"+quoteChar+"([^"+quoteChar+"]*(?:"+quoteChar+'"[^'+quoteChar+"]*)*)"+quoteChar+"|"+"([^"+quoteChar+"\\"+delimiter+"\\r\\n]*))","gi")}_.extend(DelimitedParser.prototype,{parse:function(data){var me=this,opts=this.opts;me.__rawData=data;if(opts.delimiter=="auto"){opts.delimiter=me.guessDelimiter(data,opts.skipRows);me.__delimiterPatterns=getDelimiterPatterns(opts.delimiter,opts.quoteChar)}var columns=[],closure=opts.delimiter!="|"?"|":"#",arrData;data=closure+data.replace(/\s+$/g,"")+closure;function parseCSV(delimiterPattern,strData,strDelimiter){strDelimiter=strDelimiter||",";var arrData=[[]];var arrMatches=null,strMatchedValue;while(arrMatches=delimiterPattern.exec(strData)){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&strMatchedDelimiter!=strDelimiter){arrData.push([])}if(arrMatches[2]){strMatchedValue=arrMatches[2].replace(new RegExp('""',"g"),'"')}else{strMatchedValue=arrMatches[3]}arrData[arrData.length-1].push(strMatchedValue)}if(arrData[0][0].substr(0,1)==closure){arrData[0][0]=arrData[0][0].substr(1)}var p=arrData.length-1,q=arrData[p].length-1,r=arrData[p][q].length-1;if(arrData[p][q].substr(r)==closure){arrData[p][q]=arrData[p][q].substr(0,r)}return arrData}function transpose(arrMatrix){var a=arrMatrix,w=a.length?a.length:0,h=a[0]instanceof Array?a[0].length:0;if(h===0||w===0){return[]}var i,j,t=[];for(i=0;i<h;i++){t[i]=[];for(j=0;j<w;j++){t[i][j]=a[j][i]}}return t}function makeDataset(arrData,skipRows,emptyValue,firstRowIsHeader,firstColIsHeader){var columns=[],columnNames={},rowCount=arrData.length,columnCount=arrData[0].length,rowIndex=skipRows;var srcColumns=[];if(firstRowIsHeader){srcColumns=arrData[rowIndex];rowIndex++}for(var c=0;c<columnCount;c++){var col=_.isString(srcColumns[c])?srcColumns[c].replace(/^\s+|\s+$/g,""):"",suffix=col!==""?"":1;col=col!==""?col:"X.";while(columnNames[col+suffix]!==undefined){suffix=suffix===""?1:suffix+1}columns.push({name:col+suffix,data:[]});columnNames[col+suffix]=true}_.each(_.range(1,rowCount),function(rowIndex){_.each(columns,function(c,i){c.data.push(arrData[rowIndex][i]!==""?arrData[rowIndex][i]:emptyValue)})});columns=_.map(columns,function(c){return dw.column(c.name,c.data)});return dw.dataset(columns,{firstColumnAsLabel:firstColIsHeader})}arrData=parseCSV(this.__delimiterPatterns,data,opts.delimiter);if(opts.transpose){arrData=transpose(arrData);var t=opts.firstRowIsHeader;opts.firstRowIsHeader=opts.firstColumnIsHeader;opts.firstColumnIsHeader=t}return makeDataset(arrData,opts.skipRows,opts.emptyValue,opts.firstRowIsHeader,opts.firstColumnIsHeader)},guessDelimiter:function(strData){var maxMatchCount=0,k=-1,me=this,delimiters=["	",";","|",","];_.each(delimiters,function(delimiter,i){var regex=getDelimiterPatterns(delimiter,me.quoteChar),c=strData.match(regex).length;if(c>maxMatchCount){maxMatchCount=c;k=i}});return delimiters[k]}});var Chart=Datawrapper.Chart=function(attributes){this.__attributes=attributes};_.extend(Chart.prototype,{get:function(key,_default){var keys=key.split("."),pt=this.__attributes;_.each(keys,function(key){if(pt===undefined){return _default}pt=pt[key]});return _.isUndefined(pt)||_.isNull(pt)?_default:pt},dataset:function(callback,ignoreTranspose){var me=this,ds,dsOpts={delimiter:"auto",url:"data",transpose:ignoreTranspose?false:this.get("metadata.data.transpose",false),firstRowIsHeader:this.get("metadata.data.horizontal-header",true),firstColumnIsHeader:this.get("metadata.data.vertical-header",true)};me.__dataset=ds=new Datawrapper.Dataset(dsOpts);ds.fetch({success:function(){callback(ds);if(me.__datasetLoadedCallbacks){for(var i=0;i<me.__datasetLoadedCallbacks.length;i++){me.__datasetLoadedCallbacks[i](me)}}}});return ds},rawData:function(rawData){var me=this,dsOpts={rawData:rawData,delimiter:"auto",transpose:this.get("metadata.data.transpose",false),firstRowIsHeader:this.get("metadata.data.horizontal-header",true),firstColumnIsHeader:this.get("metadata.data.vertical-header",true)};me.__dataset=ds=new Datawrapper.Dataset(dsOpts);ds.fetchRaw()},datasetLoaded:function(callback){var me=this;if(me.__dataset.__loaded){callback(me)}else{if(!me.__datasetLoadedCallbacks)me.__datasetLoadedCallbacks=[];me.__datasetLoadedCallbacks.push(callback)}},dataSeries:function(sortByFirstValue,reverseOrder){var me=this;ds=[];me.__dataset.eachSeries(function(series,i){ds.push(series)});if(sortByFirstValue===true){ds=ds.sort(function(a,b){return b.data[0]>a.data[0]?1:-1})}else if($.type(sortByFirstValue)=="number"){ds=ds.sort(function(a,b){return b.origdata[sortByFirstValue]>a.origdata[sortByFirstValue]?1:-1})}if(reverseOrder)ds.reverse();return ds},seriesByName:function(name){return this.__dataset.series(name)},numRows:function(){return this.__dataset.numRows()},hasColHeader:function(invert){var t=this.get("metadata.data.transpose");if(invert?!t:t){return this.get("metadata.data.vertical-header")}else{return this.get("metadata.data.horizontal-header")}},hasRowHeader:function(){return this.hasColHeader(true)},rowHeader:function(){var ds=this.__dataset;return this.hasRowHeader()?{data:ds.rowNames()}:false},rowLabels:function(){if(this.hasRowHeader()){return this.rowHeader().data}else{var rh=[];for(var i=0;i<this.numRows();i++)rh.push("Row "+(i+1));return rh}},rowLabel:function(r){if(this.hasRowHeader()){return this.rowHeader().data[r]}else{return r}},hasHighlight:function(){var hl=this.get("metadata.visualize.highlighted-series");return _.isArray(hl)&&hl.length>0},isHighlighted:function(col){if(col===undefined)return false;var hl=this.get("metadata.visualize.highlighted-series");return!_.isArray(hl)||hl.length===0||_.indexOf(hl,col.name)>=0},setLocale:function(locale,metric_prefix){Globalize.culture(locale);this.locale=locale;this.metric_prefix=metric_prefix},formatValue:function(val,full,round){var me=this,format=me.get("metadata.describe.number-format"),div=Number(me.get("metadata.describe.number-divisor")),append=me.get("metadata.describe.number-append","").replace(" ","&nbsp;"),prepend=me.get("metadata.describe.number-prepend","").replace(" ","&nbsp;");if(div!==0)val=Number(val)/Math.pow(10,div);if(format!="-"){if(round||val==Math.round(val))format=format.substr(0,1)+"0";val=Globalize.format(val,format)}else if(div!==0){val=val.toFixed(1)}return full?prepend+val+append:val},filterRow:function(row){this.__dataset.filterRows([row])},filterRows:function(rows){this.__dataset.filterRows(rows)},hasMissingValues:function(){var missValues=false;_.each(this.dataSeries(),function(ds){_.each(ds.data,function(val){if(val!=Number(val)){missValues=true;return false}});if(missValues)return false});return missValues}});var EditableChart=Datawrapper.EditableChart=function(attributes){var me=this;me.__attributes=attributes;me.__changed=false;me.__changeCallbacks=[];me.__saveCallbacks=[];me.__syncedElements=[]};_.extend(EditableChart.prototype,Datawrapper.Chart.prototype,{set:function(key,value){var keys=key.split("."),me=this,lastKey=keys.pop(),pt=me.__attributes;_.each(keys,function(key){if(_.isArray(pt[key])&&pt[key].length===0){pt[key]={}}pt=pt[key]});if(!_.isEqual(pt[lastKey],value)){pt[lastKey]=value;me.__changed=true;clearTimeout(me.__saveTimeout);me.__saveTimeout=setTimeout(function(){me.save()},800);_.each(me.__changeCallbacks,function(cb){cb.call(this,me,key,value)})}return this},onChange:function(callback){this.__changeCallbacks.push(callback)},sync:function(el,attribute,_default){if(_.isString(el))el=$(el);el.data("sync-attribute",attribute);var curVal=this.get(attribute,_default);if(el.is("input[type=checkbox]")){if(curVal)el.attr("checked","checked");else el.removeAttr("checked")}else if(el.is("input[type=text]")||el.is("textarea")||el.is("select")){el.val(curVal)}else if(el.is("input[type=radio]")){if(_.isBoolean(curVal)){curVal=curVal?"yes":"no"}$("input:radio[name="+el.attr("name")+"][value="+curVal+"]").attr("checked","checked")}var chart=this;chart.__syncedElements.push(el);function storeElementValue(el){var attr,val;attr=el.data("sync-attribute");if(el.is("input[type=checkbox]")){val=el.attr("checked")=="checked"}else if(el.is("input[type=text]")||el.is("textarea")||el.is("select")){val=el.val()}else if(el.is("input[type=radio]")){val=$("input:radio[name="+el.attr("name")+"]:checked").val();if(val==="yes")val=true;else if(val==="no")val=false}if(val!==undefined){chart.set(attr,val)}}el.change(function(evt){storeElementValue($(evt.target))});if(el.is("input[type=text]")||el.is("textarea")){el.keyup(function(evt){storeElementValue($(evt.target))})}window.onbeforeunload=function(e){if(chart.__changed)return"Caution: unsaved changes"}},onSave:function(callback){this.__saveCallbacks.push(callback)},save:function(sync){if(!this.__changed)return false;clearTimeout(this.__saveTimeout);var chart=this;$.ajax({url:"/api/charts/"+this.get("id"),type:"PUT",dataType:"json",data:JSON.stringify(this.__attributes),processData:false,context:this,success:function(data){if(data.status=="ok"){this.__changed=false;_.each(this.__saveCallbacks,function(cb){cb.call(this,chart)})}else{console.warn("could not save the chart",data)}}});return true}});(function(){Datawrapper.Themes={};Datawrapper.Themes.Base=_.extend({},{colors:{palette:["#6E7DA1","#64A4C4","#53CCDD","#4EF4E8"],secondary:["#000000","#777777","#cccccc","#ffd500","#6FAA12"],positive:"#85B4D4",negative:"#E31A1C",background:"#ffffff",text:"#000000"},padding:{left:0,right:20,bottom:30,top:10},lineChart:{strokeWidth:3,maxLabelWidth:80,fillOpacity:.2,xLabelOffset:20},columnChart:{cutGridLines:false,barAttrs:{"stroke-width":1}},barChart:{barAttrs:{"stroke-width":1}},xAxis:{stroke:"#333"},yAxis:{strokeWidth:1},horizontalGrid:{stroke:"#d9d9d9"},verticalGrid:false,frame:false,frameStrokeOnTop:false,yTicks:false,hover:true,tooltip:true,hpadding:0,vpadding:10,minWidth:400,locale:"de_DE",duration:1e3,easing:"expoInOut"})}).call(this);Datawrapper.Parsers={};Datawrapper.Parsers.Delimited=function(options){options=options||{};this.delimiter=options.delimiter||",";this.quoteChar=options.quoteChar||'"';this.skipRows=options.skipRows||0;this.emptyValue=options.emptyValue||null;this.transpose=options.transpose||false;this.firstRowIsHeader=options.firstRowIsHeader!==undefined?options.firstRowIsHeader:true;this.firstColumnIsHeader=options.firstRowIsHeader!==undefined?options.firstColumnIsHeader:true;this.getDelimiterPatterns=function(delimiter,quoteChar){return new RegExp("(\\"+delimiter+"|\\r?\\n|\\r|^)"+"(?:"+quoteChar+"([^"+quoteChar+"]*(?:"+quoteChar+'"[^'+quoteChar+"]*)*)"+quoteChar+"|"+"([^"+quoteChar+"\\"+delimiter+"\\r\\n]*))","gi")};this.__delimiterPatterns=this.getDelimiterPatterns(this.delimiter,this.quoteChar)};_.extend(Datawrapper.Parsers.Delimited.prototype,Datawrapper.Parsers.prototype,{parse:function(data){this.__rawData=data;if(this.delimiter=="auto"){this.delimiter=this.guessDelimiter(data,this.skipRows);this.__delimiterPatterns=this.getDelimiterPatterns(this.delimiter,this.quoteChar)}var columns=[],closure=this.delimiter!="|"?"|":"#",arrData;data=closure+data.replace(/\s+$/g,"")+closure;var parseCSV=function(delimiterPattern,strData,strDelimiter){strDelimiter=strDelimiter||",";var arrData=[[]];var arrMatches=null,strMatchedValue;while(arrMatches=delimiterPattern.exec(strData)){var strMatchedDelimiter=arrMatches[1];if(strMatchedDelimiter.length&&strMatchedDelimiter!=strDelimiter){arrData.push([])}if(arrMatches[2]){strMatchedValue=arrMatches[2].replace(new RegExp('""',"g"),'"')}else{strMatchedValue=arrMatches[3]}arrData[arrData.length-1].push(strMatchedValue)}if(arrData[0][0].substr(0,1)==closure){arrData[0][0]=arrData[0][0].substr(1)}var p=arrData.length-1,q=arrData[p].length-1,r=arrData[p][q].length-1;if(arrData[p][q].substr(r)==closure){arrData[p][q]=arrData[p][q].substr(0,r)}return arrData},transpose=function(arrMatrix){var a=arrMatrix,w=a.length?a.length:0,h=a[0]instanceof Array?a[0].length:0;if(h===0||w===0){return[]}var i,j,t=[];for(i=0;i<h;i++){t[i]=[];for(j=0;j<w;j++){t[i][j]=a[j][i]}}return t};parseDataArray=function(arrData,skipRows,emptyValue,firstRowIsHeader,firstColIsHeader){var series=[],seriesNames={},rowCount=arrData.length,columnCount=arrData[0].length,rowIndex=skipRows;var srcColumns=[];if(firstRowIsHeader){srcColumns=arrData[rowIndex];rowIndex++}for(var c=0;c<columnCount;c++){var col=_.isString(srcColumns[c])?srcColumns[c].replace(/^\s+|\s+$/g,""):"",suffix=col!==""?"":1;col=col!==""?col:"X.";while(seriesNames[col+suffix]!==undefined){suffix=suffix===""?1:suffix+1}series.push({name:col+suffix,data:[]});seriesNames[col+suffix]=true}for(;rowIndex<rowCount;rowIndex++){_.each(series,function(s,i){s.data.push(arrData[rowIndex][i]!==""?arrData[rowIndex][i]:emptyValue)})}var header;if(firstColIsHeader){header=series[0];series=series.slice(1)}return{series:series,rowNames:header?header.data:undefined,rowNameLabels:header?header.name:undefined}},arrData=parseCSV(this.__delimiterPatterns,data,this.delimiter);if(this.transpose){arrData=transpose(arrData);var t=this.firstRowIsHeader;this.firstRowIsHeader=this.firstColumnIsHeader;this.firstColumnIsHeader=t}return parseDataArray(arrData,this.skipRows,this.emptyValue,this.firstRowIsHeader,this.firstColumnIsHeader)},guessDelimiter:function(strData){var maxMatchCount=0,k=-1,me=this,delimiters=["	",";","|",","];_.each(delimiters,function(delimiter,i){var regex=me.getDelimiterPatterns(delimiter,me.quoteChar),c=strData.match(regex).length;if(c>maxMatchCount){maxMatchCount=c;k=i}});return delimiters[k]}});Datawrapper.Visualizations={};var Base=function(){};_.extend(Base.prototype,{render:function(el){$(el).html("implement me!")},setTheme:function(theme){this.theme=theme;var attr_properties=["horizontalGrid","verticalGrid","yAxis","xAxis"];_.each(attr_properties,function(prop){if(theme.hasOwnProperty(prop)){for(var key in theme[prop]){var lkey=key.replace(/([A-Z])/g,"-$1").toLowerCase();if(!theme[prop].hasOwnProperty(lkey)){theme[prop][lkey]=theme[prop][key]}}}});return this},setSize:function(width,height){var me=this;me.__w=width;me.__h=height;return me},load:function(chart,callback){var me=this;this.chart=chart;chart.dataset(function(ds){me.dataset=ds;me.dataset.filterSeries(chart.get("metadata.data.ignore-series",{}));callback.call(me,me)})},get:function(str,_default){return this.chart.get("metadata.visualize."+str,_default)},warn:function(str){var warning=$("<div>"+str+"</div>");warning.css({"background-color":"#FCF8E3",border:"1px solid #FBEED5","border-radius":"4px 4px 4px 4px",color:"#a07833","margin-bottom":"18px",padding:"8px 35px 8px 14px","text-shadow":"0 1px 0 rgba(255, 255, 255, 0.5)",left:"10%",right:"10%","z-index":1e3,"text-align":"center",position:"absolute"});$("body").prepend(warning);warning.hide();warning.fadeIn()},signature:function(){},translate:function(str){var locale=this.meta.locale,lang=this.lang;return locale[str]?locale[str][lang]||locale[str]:str}});Datawrapper.Visualizations.Base=Base.prototype}).call(this);